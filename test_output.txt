-- Running tests in serial mode.
Destroying test database for alias 'default'...
Using existing clone for alias 'default'...
Running zerver.tests.test_events.RealmPropertyActionTest.test_change_realm_property
Found 1 test(s).

---States DO NOT MATCH---

EVENTS:

{
    "type": "realm",
    "op": "update",
    "property": "default_new_user_avatar",
    "value": "jdenticon",
    "id": 0
}

MISMATCHES:


key = avatar_url_medium
{'ava[13 chars]m': 'https://secure.gravatar.com/avatar/6d8cad[51 chars]n=1'} != {'ava[13 chars]m': '/avatar/jdenticon/690a8d04077aa518ca7d084[42 chars]128'}
- {'avatar_url_medium': 'https://secure.gravatar.com/avatar/6d8cad0fd00256e7b40691d27ddfd466?d=identicon&s=500&version=1'}
+ {'avatar_url_medium': '/avatar/jdenticon/690a8d04077aa518ca7d084bea25bee3f452b99942da222469f0de7059ec94a1/128'} : 

key = avatar_url
{'avatar_url': 'https://secure.gravatar.com/avatar/6d8cad[45 chars]n=1'} != {'avatar_url': '/avatar/jdenticon/690a8d04077aa518ca7d084[41 chars]/80'}
- {'avatar_url': 'https://secure.gravatar.com/avatar/6d8cad0fd00256e7b40691d27ddfd466?d=identicon&version=1'}
+ {'avatar_url': '/avatar/jdenticon/690a8d04077aa518ca7d084bea25bee3f452b99942da222469f0de7059ec94a1/80'} : 

key = realm_users
{'rea[329 chars]l': 'https://secure.gravatar.com/avatar/818c21[6077 chars] 6}]} != {'rea[329 chars]l': '/avatar/jdenticon/b54d027418d89692fe09281[6037 chars] 6}]}
- {'realm_users': [{'avatar_url': 'https://secure.gravatar.com/avatar/818c212b9f8830dfef491b3f7da99a14?d=identicon&version=1',
+ {'realm_users': [{'avatar_url': '/avatar/jdenticon/b54d027418d89692fe092815cbee04ec24ec0f4b34f7491357bf912ad6cd4afb/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user6@zulip.testserver',
                    'full_name': 'aaron',
                    'is_admin': False,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {},
                    'role': 400,
                    'timezone': 'America/Los_Angeles',
                    'user_id': 6},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/0f030c97ab51312c7bbffd3966198ced?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/6e28c0ab373df502002a6ea5312773ced037a93254afa0bd4290eb9102e72c3b/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user7@zulip.testserver',
                    'full_name': 'Zoe',
                    'is_admin': False,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {},
                    'role': 400,
                    'timezone': 'America/New_York',
                    'user_id': 7},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/77c3871a68c8d70356156029fd0a4999?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/0f9b9a11dd0d905759e2de4d0a712ff9fc4c9a8ad4321c82449015820cd2bbfb/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user8@zulip.testserver',
                    'full_name': "Cordelia, Lear's daughter",
                    'is_admin': False,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {},
                    'role': 400,
                    'timezone': 'Etc/UTC',
                    'user_id': 8},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/1eaadc3ca3c2a058cb9e3570e42e59d2?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/508aaabc0c537e849616738b19f990ace750a7de83b654d765ad9d23781c393e/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user9@zulip.testserver',
                    'full_name': 'Desdemona',
                    'is_admin': True,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': True,
                    'profile_data': {},
                    'role': 100,
                    'timezone': 'America/St_Johns',
                    'user_id': 9},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/6d8cad0fd00256e7b40691d27ddfd466?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/690a8d04077aa518ca7d084bea25bee3f452b99942da222469f0de7059ec94a1/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': 'hamlet@zulip.com',
                    'email': 'user10@zulip.testserver',
                    'full_name': 'King Hamlet',
                    'is_admin': False,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {'1': {'rendered_value': '<p>+0-11-23-456-7890</p>',
                                           'value': '+0-11-23-456-7890'},
                                     '2': {'rendered_value': '<p>I am:</p>\n'
                                                             '<ul>\n'
                                                             '<li>The prince of '
                                                             'Denmark</li>\n'
                                                             '<li>Nephew to the '
                                                             'usurping '
                                                             'Claudius</li>\n'
                                                             '</ul>',
                                           'value': 'I am:\n'
                                                    '* The prince of Denmark\n'
                                                    '* Nephew to the usurping '
                                                    'Claudius'},
                                     '3': {'rendered_value': '<p>Dark '
                                                             'chocolate</p>',
                                           'value': 'Dark chocolate'},
                                     '4': {'value': '0'},
                                     '5': {'value': '1900-01-01'},
                                     '6': {'value': 'https://blog.zulig.org'},
                                     '7': {'value': '[11]'},
                                     '8': {'value': 'zulipbot'},
                                     '9': {'value': 'he/him'}},
                    'role': 400,
                    'timezone': '',
                    'user_id': 10},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/af4f06322c177ef4e1e9b2c424986b54?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/ac67156e065d00386cfe787e9647849ba435b015ee9dfeb70ae7d080e5bd45ee/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user11@zulip.testserver',
                    'full_name': 'Iago',
                    'is_admin': True,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {'1': {'rendered_value': '<p>+1-234-567-8901</p>',
                                           'value': '+1-234-567-8901'},
                                     '2': {'rendered_value': '<p>Betrayer of '
                                                             'Othello.</p>',
                                           'value': 'Betrayer of Othello.'},
                                     '3': {'rendered_value': '<p>Apples</p>',
                                           'value': 'Apples'},
                                     '4': {'value': '1'},
                                     '5': {'value': '2000-01-01'},
                                     '6': {'value': 'https://zulip.readthedocs.io/en/latest/'},
                                     '7': {'value': '[10]'},
                                     '8': {'value': 'zulip'},
                                     '9': {'value': 'he/him'}},
                    'role': 200,
                    'timezone': 'America/New_York',
                    'user_id': 11},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/23f350365c96af9aaf864778f4728375?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/f04bd04fca47f2011b4727ba008d4fe5d2f90c0214320edcc07ea6b446024e86/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user12@zulip.testserver',
                    'full_name': 'Othello, the Moor of Venice',
                    'is_admin': False,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {},
                    'role': 400,
                    'timezone': 'America/Los_Angeles',
                    'user_id': 12},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/32f1c18f22a1f1b1740e9ced2c1f0c94?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/1dfdb1fc3e747ddee16e145d6594da2b0058ca9517eb24c7782aa2702b44e9a4/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user13@zulip.testserver',
                    'full_name': 'Polonius',
                    'is_admin': False,
                    'is_bot': False,
                    'is_guest': True,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {},
                    'role': 600,
                    'timezone': 'Asia/Shanghai',
                    'user_id': 13},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/3a2a277c8364e80096c822881a815198?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/01541a85847b9a928a6f4505504f77c668ff5a7877c7f46855a8cacc0f973611/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user14@zulip.testserver',
                    'full_name': 'Prospero from The Tempest',
                    'is_admin': False,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {},
                    'role': 400,
                    'timezone': '',
                    'user_id': 14},
-                  {'avatar_url': 'https://secure.gravatar.com/avatar/2ce23a9fe06e0a36217fb2fc2754f372?d=identicon&version=1',
+                  {'avatar_url': '/avatar/jdenticon/dd57a9ed2f8ff5cc2f5490129e271610fd23c2f356a99fd0c1c2ed7359509985/80',
                    'avatar_version': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': None,
                    'email': 'user15@zulip.testserver',
                    'full_name': 'शिव',
                    'is_admin': False,
                    'is_bot': False,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'profile_data': {},
                    'role': 300,
                    'timezone': 'Asia/Kolkata',
                    'user_id': 15},
                   {'avatar_url': None,
                    'avatar_version': 1,
                    'bot_owner_id': 9,
                    'bot_type': 1,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': 'default-bot@zulip.com',
                    'email': 'default-bot@zulip.com',
                    'full_name': 'Zulip Default Bot',
                    'is_admin': False,
                    'is_bot': True,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'role': 400,
                    'timezone': '',
                    'user_id': 16},
                   {'avatar_url': None,
                    'avatar_version': 1,
                    'bot_owner_id': 7,
                    'bot_type': 2,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': 'webhook-bot@zulip.com',
                    'email': 'webhook-bot@zulip.com',
                    'full_name': 'Zulip Webhook Bot',
                    'is_admin': False,
                    'is_bot': True,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'role': 400,
                    'timezone': '',
                    'user_id': 17},
                   {'avatar_url': None,
                    'avatar_version': 1,
                    'bot_owner_id': 6,
                    'bot_type': 3,
                    'date_joined': '2025-11-15T17:16+00:00',
                    'delivery_email': 'outgoing-webhook@zulip.com',
                    'email': 'outgoing-webhook@zulip.com',
                    'full_name': 'Outgoing Webhook',
                    'is_admin': False,
                    'is_bot': True,
                    'is_guest': False,
                    'is_imported_stub': False,
                    'is_owner': False,
                    'role': 400,
                    'timezone': '',
                    'user_id': 18}]} : 

                NOTE:

                    This is an advanced test that verifies how
                    we apply events after fetching data.  If you
                    do not know how to debug it, you can ask for
                    help on chat.
                

======================================================================
FAIL: test_change_realm_property (zerver.tests.test_events.RealmPropertyActionTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/vedvn/zulip/zerver/tests/test_events.py", line 4702, in test_change_realm_property
    self.do_set_realm_property_test(prop)
  File "/home/vedvn/zulip/zerver/tests/test_events.py", line 4453, in do_set_realm_property_test
    with self.verify_action(
  File "/usr/lib/python3.10/contextlib.py", line 142, in __exit__
    next(self.gen)
  File "/home/vedvn/zulip/zerver/tests/test_events.py", line 504, in verify_action
    self.match_states(hybrid_state, normal_state, events)
  File "/home/vedvn/zulip/zerver/tests/test_events.py", line 584, in match_states
    raise AssertionError("Mismatching states")
AssertionError: Mismatching states

----------------------------------------------------------------------
Ran 1 test in 10.991s

FAILED (failures=1)
Destroying test database for alias 'default'...
